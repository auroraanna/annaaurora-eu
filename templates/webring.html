{% import "macros/head.html" as head -%}
{% import "macros/toc.html" as toc -%}
{% extends "base.html" -%}

{%- block math -%}
  {% if page.extra.math %}
  {{ head::katex() }}
  {% endif %}
{%- endblock math -%}

{%- block title %}
    <title>{{ page.title }}</title>
    {# TODO: make some kind of social media linking, i guess? #}
    {#%- include "snippets/social.html" %#}
{%- endblock title -%}

{%- block main -%}
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="{{ page.permalink  }}">{{ page.title }}</a>
            </h1>

            {{ posts::meta(page=page) }}
            {{ posts::langs(page=page) }}

            {%- block toc -%}
                {%- if page.extra.toc or config.extra.toc -%}
                    {{ toc::toc(t=page.toc) }}
                {%- endif -%}
            {%- endblock toc -%}
        </header>

        {{ page.content | safe }}
    </article>
    <footer>
        {#
        For some reason loading the json directly over HTTPS doesn't work.
        {% set be_crime_do_gay = load_data(url="https://artemislena.eu/services/downloads/beCrimeDoGay.json") %}
        #}
        {% set be_crime_do_gay = load_data(path="static/webrings/be_crime_do_gay.json") %}
        {% set be_crime_do_gay_length = be_crime_do_gay | length %}
        {% for i in range(end=be_crime_do_gay_length) %}
            {% if be_crime_do_gay[i] == "https://papojari.codeberg.page/webring/" %}
                {% set_global own_index = i %}{% break %}
            {% endif %}
        {% endfor %}
        {% set left = own_index - 1 %}
        {% if left < 0 %}
            {% set left = be_crime_do_gay_length %}
            {% set left = left - 1 %}
        {% endif %}
        {% set right = own_index + 1 %}
        {% if right >= be_crime_do_gay_length %}
            {% set right = 0 %}
        {% endif %}
        <nav class="menu" style="display: flex; justify-content: space-evenly;">
            <a href="{{be_crime_do_gay[left]}}" class="prev-next">← Go left</a>
            <a href="{{be_crime_do_gay[right]}}" class="prev-next">Go right →</a>
        </nav>
    </footer>


{%- endblock main -%}
